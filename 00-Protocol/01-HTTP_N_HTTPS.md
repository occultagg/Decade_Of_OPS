# HTTP

1. 通过TCP 3 次握手建立连接

2. 发送http请求(请求方法,请求资源URI,请求头等)

3. 服务器响应请求(状态码,响应头和响应体等)

4. 响应完成tcp4次挥手断开连接

   > http是无状态协议,跟踪对话需要cookie,session机制

## Cookie & Session

|          | cookie                                         | session                         |
| -------- | ---------------------------------------------- | ------------------------------- |
| 存储位置 | 客户端(浏览器)                                 | 服务端                          |
| 安全性   | 较低(易窃取)                                   | 较高                            |
| 数据容量 | 小(~4KB)                                       | 根据服务器而定                  |
| 生命周期 | 可持久或会话级                                 | 通常会话级(可配置)              |
| 依赖关系 | 无需服务器存储                                 | 依赖cookie携带ID                |
| 适用场景 | 非敏感数据跟踪(用户偏好,跟踪广告,记住用户名等) | 敏感状态管理(认证信息,购物车等) |

> cookie一个信封,直接把数据传给服务端.
>
> Session像是服务器上的保险箱,当使用Session时,需要用Cookie寄个钥匙(ID)给服务器,服务端根据钥匙打开保险箱取出里面的数据.
>
> 现代Web开发中,一般用Token-based认证(JWT)来避免服务器的Session开销.
>
> Localstorage类似cookie,也是用来存储一些非敏感数据,但是它不参与与服务的交互,因此一般用来存储客户端的持久数据(比如缓存)

# HTTPS

- 握手阶段: (非对称加密)

  - RRT1:

    - **client hello**:客户端发起一个https请求,附带客户端支持的TLS版本,加密方式等
    - **server hello**:服务端根据客户端支持的TLS版本,加密方式等生成临时密钥对,并发送公钥,同时发送服务器证书(包括公钥,由CA签名)

  - RRT2

    - 客户端验证服务端身份后,通过一种安全的方式发送密钥材料(比如通过数学算法生成的随机密钥),然后计算出一个相同的"共享密钥"(对称密钥),发送"change cipher 和 finished"消息,表示完成握手

      > 客户端如何验证服务端身份: 客户端检查服务器证书的CA签名是否受信,是否过期,域名是否匹配等

    - 服务端也计算出相同的"共享密钥"(对称密钥),发送"change cipher 和 finished"消息,表示完成握手

- 通信阶段: (对称加密)

  1. 使用握手协商的"对称密钥"加解密通讯数据(record)
  2. 通信期间可以重协商密钥(TLS1.3弃用)